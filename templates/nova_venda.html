{% extends "base.html" %}
{% block content %}
<div class="header">
    <button class="back-btn" onclick="window.location.href='{{ url_for('dashboard') }}'">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
        </svg>
    </button>
    <h1>Registro de Vendas</h1>
</div>

<form method="POST" action="{{ url_for('salvar_venda') }}" style="flex: 1; display: flex; flex-direction: column;">
    <div class="content">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-danger">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <div class="form-group">
            <label for="data_atendimento">Data do Atendimento</label>
            <input type="text" id="data_atendimento" name="data_atendimento" class="form-control bg-gray" 
                   placeholder="DD/MM/AAAA" maxlength="10" required>
        </div>
        
        <div class="form-group">
            <label for="valor_bruto">Valor Bruto</label>
            <input type="text" id="valor_bruto" name="valor_bruto" class="form-control bg-gray" 
                   placeholder="R$ 0,00" required>
        </div>
        
        <div class="form-group">
            <label>Forma de Pagamento</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" id="pix" name="forma_pagamento" value="pix" required>
                    <label for="pix">Pix</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="debito" name="forma_pagamento" value="debito">
                    <label for="debito">Débito</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="credito" name="forma_pagamento" value="credito">
                    <label for="credito">Crédito</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="especie" name="forma_pagamento" value="especie">
                    <label for="especie">Espécie</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="transferencia" name="forma_pagamento" value="transferencia">
                    <label for="transferencia">Transferência</label>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="observacoes">Observações</label>
            <textarea id="observacoes" name="observacoes" class="form-control bg-gray" 
                      placeholder="Adicione informações relevantes"></textarea>
        </div>
    </div>
    
    <div class="btn-group">
        <button type="button" class="btn btn-secondary" onclick="window.location.href='{{ url_for('dashboard') }}'">
            Cancelar
        </button>
        <button type="submit" class="btn btn-primary">
            Salvar
        </button>
    </div>
</form>

<script>
// Máscara para data
document.getElementById('data_atendimento').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    value = value.replace(/(\d{2})(\d)/, '$1/$2');
    value = value.replace(/(\d{2})(\d)/, '$1/$2');
    e.target.value = value;
});

// Máscara para valor
document.getElementById('valor_bruto').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    value = (parseFloat(value) / 100).toFixed(2);
    value = 'R$ ' + value.replace('.', ',').replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
    e.target.value = value;
});

// Definir data atual
document.getElementById('data_atendimento').value = new Date().toLocaleDateString('pt-BR');
</script>
{% endblock %}